(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{339:function(e,t,n){"use strict";var r=n(349),a=n.n(r);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.version=n}var t,n,r;return t=e,(n=[{key:"_connect",value:function(){return a.a.open(this.name,this.version,function(e){(e.objectStoreNames.contains("restaurants")||e.createObjectStore("restaurants",{keyPath:"id"}),e.objectStoreNames.contains("reviews"))||e.createObjectStore("reviews",{keyPath:"id"}).createIndex("restaurant","restaurant_id");e.objectStoreNames.contains("pending-reviews")||e.createObjectStore("pending-reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant","restaurant_id")})}},{key:"writeData",value:function(e,t){return this._connect().then(function(n){var r=n.transaction(e,"readwrite");return Array.isArray(t)?t.forEach(function(t){return r.objectStore(e).put(t)}):r.objectStore(e).put(t),r.complete})}},{key:"readData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._connect().then(function(r){var a=r.transaction(e).objectStore(e);return t?n?a.index(n).getAll(t):a.get(t):a.getAll()})}},{key:"deleteData",value:function(e,t){return this._connect().then(function(n){return n.transaction(e,"readwrite").objectStore(e).delete(t).complete})}},{key:"clearData",value:function(e){return this._connect().then(function(t){return t.transaction(e,"readwrite").objectStore(e).clear().complete})}}])&&i(t.prototype,n),r&&i(t,r),e}();var o,s,u=(o=regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return e.next=4,e.sent.json();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}),s=function(){var e=this,t=arguments;return new Promise(function(n,r){var a=o.apply(e,t);function i(e,t){try{var i=a[e](t),o=i.value}catch(e){return void r(e)}i.done?n(o):Promise.resolve(o).then(c,s)}function c(e){i("next",e)}function s(e){i("throw",e)}c()})},function(e){return s.apply(this,arguments)}),f=null;(f=n(348).default).MODE="production";var l=f;function v(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function c(e,t){try{var n=i[e](t),c=n.value}catch(e){return void a(e)}n.done?r(c):Promise.resolve(c).then(o,s)}function o(e){c("next",e)}function s(e){c("throw",e)}o()})}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.db=new c("restaurant-reviews",3)}var t,n,r;return t=e,(n=[{key:"_fetchResource",value:function(){var e=h(regeneratorRuntime.mark(function e(t,n){var r,a,i=this,c=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:null,a=c.length>3&&void 0!==c[3]?c[3]:null,e.abrupt("return",new Promise(function(){var e=h(regeneratorRuntime.mark(function e(c,o){var s,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u("".concat(i.DB_URL,"/").concat(t));case 3:s=e.sent,i.db.writeData(n,s),c(s),e.next=14;break;case 8:return e.prev=8,e.t0=e.catch(0),e.next=12,i.db.readData(n,r,a);case 12:(f=e.sent)?c(f):o(e.t0.message);case 14:case"end":return e.stop()}},e,this,[[0,8]])}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"calculateAverageReview",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.MAX_REVIEW_SCORE;return e.reduce(function(e,t){return e+t.rating},0)/(e.length*t)*100}},{key:"restaurantImgUrl",value:function(e){var t=e.id,n=e.size;return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?"./images/".concat(t,"-").concat(n,".jpg"):"".concat(this.BASE_URL,"/images/").concat(t,"-").concat(n,".jpg")}},{key:"restaurantUrl",value:function(e){return!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?"./restaurant.html?id=".concat(e):"".concat(this.BASE_URL,"/restaurant.html?id=").concat(e)}},{key:"fetchRestaurants",value:function(){return this._fetchResource("restaurants","restaurants")}},{key:"fetchFavoriteRestaurants",value:function(){var e,t=this;return new Promise((e=h(regeneratorRuntime.mark(function e(n,r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchRestaurants();case 3:a=e.sent,n(a.filter(function(e){return e.is_favorite})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r(e.t0);case 10:case"end":return e.stop()}},e,this,[[0,7]])})),function(t,n){return e.apply(this,arguments)}))}},{key:"fetchRestaurant",value:function(e){return this._fetchResource("restaurants/".concat(e),"restaurants",e)}},{key:"fetchReviews",value:function(){return this._fetchResource("reviews","reviews")}},{key:"fetchReview",value:function(e){return this._fetchResource("reviews/".concat(e),"reviews",e)}},{key:"fetchRestaurantReviews",value:function(e){var t,n=this;return new Promise((t=h(regeneratorRuntime.mark(function t(r,a){var i,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n._fetchResource("reviews/?restaurant_id=".concat(e),"reviews",e,"restaurant");case 3:return i=t.sent,t.next=6,n.db.readData("pending-reviews",e,"restaurant").then(function(e){return e.map(function(e){return Object.assign(e,{pending:!0})})});case 6:c=t.sent,r(v(c).concat(v(i))),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),a(t.t0);case 13:case"end":return t.stop()}},t,this,[[0,10]])})),function(e,n){return t.apply(this,arguments)}))}},{key:"fetchRestaurantWithReviews",value:function(e){var t,n=this;return new Promise((t=h(regeneratorRuntime.mark(function t(r,a){var i,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.fetchRestaurant(e);case 3:return i=t.sent,t.next=6,n.fetchRestaurantReviews(e);case 6:c=t.sent,i.reviews=c||[],i.averageReview=n.calculateAverageReview(i.reviews),r(i),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),i&&(i.reviews=c||[],i.averageReview=n.calculateAverageReview(i.reviews),r(i)),a(t.t0);case 16:case"end":return t.stop()}},t,this,[[0,12]])})),function(e,n){return t.apply(this,arguments)}))}},{key:"addRestaurantReview",value:function(e){var t,n=this;return new Promise((t=h(regeneratorRuntime.mark(function t(r,a){var i,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={method:"POST",body:JSON.stringify(e),headers:new Headers({"Content-Type":"application/json"})},t.prev=1,t.next=4,fetch("".concat(n.DB_URL,"/reviews"),i);case 4:return t.next=6,t.sent.json();case 6:return t.next=8,n.fetchRestaurantReviews(e.restaurant_id);case 8:c=t.sent,r(c),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),n.db.writeData("pending-reviews",e).then(function(){r(e)}).catch(function(){a(t.t0)});case 15:case"end":return t.stop()}},t,this,[[1,12]])})),function(e,n){return t.apply(this,arguments)}))}},{key:"addPendingReviews",value:function(e){var t,n=this;return new Promise((t=h(regeneratorRuntime.mark(function t(r,a){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return navigator.onLine||a(new Error("Unable to post pending reviews, you are offline.")),t.prev=1,t.next=4,n.db.readData("pending-reviews");case 4:if(i=t.sent,!(Array.isArray(i)&&i.length>0)){t.next=9;break}return t.next=8,n.db.clearData("pending-reviews");case 8:Promise.all(i.map(function(e){var t=e.restaurant_id,r=e.name,a=e.createdAt,i=e.comments,c=e.rating,o={method:"POST",body:JSON.stringify({restaurant_id:t,name:r,comments:i,createdAt:a,rating:c}),headers:new Headers({"Content-Type":"application/json"})};return fetch("".concat(n.DB_URL,"/reviews"),o)})).then(h(regeneratorRuntime.mark(function t(){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.fetchRestaurantReviews(e);case 2:a=t.sent,r(a);case 4:case"end":return t.stop()}},t,this)})));case 9:t.next=13;break;case 11:t.prev=11,t.t0=t.catch(1);case 13:case"end":return t.stop()}},t,this,[[1,11]])})),function(e,n){return t.apply(this,arguments)}))}},{key:"setFavoriteRestaurant",value:function(e,t){var n,r=this;return new Promise((n=h(regeneratorRuntime.mark(function n(a,i){var c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,fetch("".concat(r.DB_URL,"/restaurants/").concat(e,"/?is_favorite=").concat(t),{method:"PUT"});case 3:return n.next=5,n.sent.json();case 5:c=n.sent,r.db.writeData("restaurants",c),a(c),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),i(n.t0.message);case 13:case"end":return n.stop()}},n,this,[[0,10]])})),function(e,t){return n.apply(this,arguments)}))}},{key:"BASE_URL",get:function(){return"".concat(l.HOST).concat(l.PORT&&":".concat(l.PORT))}},{key:"DB_URL",get:function(){return"".concat(l.SERVER)}},{key:"MAX_REVIEW_SCORE",get:function(){return 5}}])&&d(t.prototype,n),r&&d(t,r),e}()),m=function(e){if(e){if(URLSearchParams)return new URLSearchParams(location.search).get(e);e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]".concat(e,"=([^&#]*)")).exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}},w=function(){var e=[].slice.call(document.querySelectorAll("img.lazy")),t=!1,n=function(t){t.src=t.dataset.src,t.srcset=t.dataset.srcset,t.classList.remove("lazy"),0===(e=e.filter(function(e){return e!==t})).length&&(document.removeEventListener("scroll",r),window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r))},r=function(){!1===t&&(t=!0,setTimeout(function(){e.forEach(function(e){e.getBoundingClientRect().top<=window.innerHeight&&e.getBoundingClientRect().bottom>=0&&"none"!==getComputedStyle(e).display&&n(e)}),t=!1},200))};e.forEach(function(e){var t;(t=e.getBoundingClientRect()).top>=0&&t.left>=0&&t.top<=(window.innerHeight||document.documentElement.clientHeight)&&n(e)}),document.addEventListener("scroll",r),window.addEventListener("resize",r),window.addEventListener("orientationchange",r)},g=function(e,t){var n=e.id,r=e.src,a=e.srcset,i=e.sizes,c=e.alt,o=e.className,s=a||"".concat(p.restaurantImgUrl({id:n,size:"small"})," 800w,\n    ").concat(p.restaurantImgUrl({id:n,size:"medium"})," 1200w,\n    ").concat(p.restaurantImgUrl({id:n,size:"large"})," 1600w");return'<img \n    src="'.concat(p.BASE_URL,'/images/placeholder.png"\n    data-src="').concat(r,'"\n    data-srcset="').concat(s,'"\n    data-sizes="').concat(i,'"\n    class="').concat(o,' lazy"\n    alt="').concat(c,'"\n  />')},y=function(e){var t,n=(t=p.MAX_REVIEW_SCORE,Array(t).fill("★").join(""));return'\n    <div class="star-rating__container">\n      <div class="star-rating__top" style="width: '.concat(e||0,'%">').concat(n,'</div>\n      <div class="star-rating__bottom">').concat(n,"</div>\n    </div>\n  ")},R=function(e,t,n){for(var r=document.createDocumentFragment(),a=document.createElement("option");e.childNodes.length>1;)e.removeChild(e.lastChild);t.forEach(function(e){var t=a.cloneNode();t.textContent=e,t.value=e,e===n&&(t.selected=!0),r.appendChild(t)}),e.appendChild(r)},k=n(347),b=n(128),_=n.n(b),x=n(346),E=n.n(x),S=n(345),P=n.n(S);function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}delete k.Icon.Default.prototype._getIconUrl,k.Icon.Default.mergeOptions({iconRetinaUrl:E.a,iconUrl:_.a,shadowUrl:P.a});var A=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);n=Object.assign({},{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1},n),this._map=new k.Map(t,n),this._markers=[],new k.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.Map)}var t,n,r;return t=e,(n=[{key:"addMarkers",value:function(e,t){var n=this,r=new k.LatLngBounds;this._markers=e.map(function(e){var a=e.position,i=e.content;return r.extend(a),n.addMarker(a,i,t)}),this._markers.length>0&&(this.Map.fitBounds(r),this.Map.setZoom(12))}},{key:"addMarker",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;return new k.Marker(e).addTo(this.Map).bindPopup(n).on("click",function(e){if(t.Map.setView(e.target.getLatLng()),r)return r(e)})}},{key:"removeMarkers",value:function(){var e=this;this._markers.forEach(function(t){e.Map.removeLayer(t)})}},{key:"Map",get:function(){return this._map}}])&&j(t.prototype,n),r&&j(t,r),e}(),L=n(91);n.d(t,"a",function(){return p}),n.d(t,"c",function(){return m}),n.d(t,"d",function(){return w}),n.d(t,"e",function(){return g}),n.d(t,"f",function(){return y}),n.d(t,"b",function(){return A}),n.d(t,"g",function(){return R}),n.d(t,!1,function(){return L.a})},348:function(e,t,n){"use strict";n.r(t);t.default={HOST:"https://restaurant-reviews.netlify.com",PORT:"",SERVER:"https://mws-restaurant-reviews.herokuapp.com"}}}]);
//# sourceMappingURL=home~restaurant.min.js.map